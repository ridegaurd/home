<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Screen Share via GitHub Pages</title>
<style>
body { font-family:sans-serif; background:#111; color:#fff; text-align:center; padding:20px;}
video { width:45%; margin:10px; border:2px solid #0f0;}
#videos { display:flex; justify-content:center; flex-wrap:wrap;}
input, button { padding:10px; font-size:16px; margin:5px;}
</style>
</head>
<body>
<h2>Screen Share via GitHub Pages</h2>
<label>Enter 5-digit code:</label>
<input id="room" maxlength="5" placeholder="12345">
<button id="joinBtn">Join / Start</button>

<div id="videos">
  <div>
    <h4>Local Screen</h4>
    <video id="local" autoplay muted></video>
  </div>
  <div>
    <h4>Remote Screen</h4>
    <video id="remote" autoplay></video>
  </div>
</div>

<script src="https://unpkg.com/simple-peer@9.12.0/simplepeer.min.js"></script>
<script>
const localVideo = document.getElementById('local');
const remoteVideo = document.getElementById('remote');
const joinBtn = document.getElementById('joinBtn');
let peer;
let ws;

function generateCode() {
  return Math.floor(10000 + Math.random() * 90000).toString();
}

joinBtn.onclick = async () => {
  let room = document.getElementById('room').value;
  if (!room) room = generateCode(), alert("Your room code: " + room);

  ws = new WebSocket('wss://signaling.simple-peerjs.com');

  ws.onopen = () => ws.send(JSON.stringify({ type:'join', room }));

  ws.onmessage = (msg) => {
    const data = JSON.parse(msg.data);
    if (data.type === 'signal' && peer) peer.signal(data.signal);
  };

  const stream = await navigator.mediaDevices.getDisplayMedia({ video:true, audio:true });
  localVideo.srcObject = stream;

  peer = new SimplePeer({ initiator:true, trickle:false, stream });

  peer.on('signal', signal => ws.send(JSON.stringify({ type:'signal', signal, room })));
  peer.on('stream', remoteStream => remoteVideo.srcObject = remoteStream);
};
</script>
</body>
</html>
