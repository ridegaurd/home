<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StrxAI - Magical Chat Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevents scrollbars during animations */
            position: relative;
        }

        /* --- Magical Background --- */
        body::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at 30% 70%, rgba(126, 34, 206, 0.15), transparent 40%),
                        radial-gradient(circle at 70% 30%, rgba(219, 39, 119, 0.15), transparent 40%);
            animation: magicGradient 20s ease-in-out infinite;
            z-index: 0; /* Behind content but above bg-color */
        }

        @keyframes magicGradient {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            25% { transform: translate(15px, -20px) scale(1.05); }
            50% { transform: translate(-15px, 20px) scale(1); opacity: 0.8; }
            75% { transform: translate(20px, 15px) scale(1.05); }
            100% { transform: translate(0, 0) scale(1); opacity: 1; }
        }

        /* --- Custom Animations --- */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        @keyframes messageIn {
            from { opacity: 0; transform: translateY(10px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* --- Animation Utility Classes --- */
        .animate-fadeIn { animation: fadeIn 0.5s ease-in-out forwards; }
        .animate-fadeInUp { animation: fadeInUp 0.6s ease-in-out forwards; }
        .animate-scaleIn { animation: scaleIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }

        /* --- Page Transition Classes --- */
        #landingPage.exit {
            transition: opacity 0.5s ease-in, transform 0.5s ease-in;
            opacity: 0;
            transform: scale(0.95);
        }
        
        #chatPage.enter {
            display: flex;
            animation: scaleIn 0.5s ease-out 0.3s forwards;
        }

        /* Custom scrollbar for a cleaner look */
        #chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        #chat-messages::-webkit-scrollbar-track {
            background: #2d3748; /* bg-gray-800 */
        }
        #chat-messages::-webkit-scrollbar-thumb {
            background: #4a5568; /* bg-gray-600 */
            border-radius: 3px;
        }
        #chat-messages::-webkit-scrollbar-thumb:hover {
            background: #718096; /* bg-gray-500 */
        }
        
        /* Glassmorphism Feature Card */
        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-gray-900 text-white antialiased">

    <!-- Main container for positioning -->
    <div id="app-container" class="relative w-full h-screen z-10">

        <!-- Landing Page -->
        <div id="landingPage" class="absolute inset-0 flex flex-col items-center justify-center p-6 text-center transition-all duration-500 overflow-y-auto">
            <div class="animate-fadeInUp" style="animation-delay: 0.2s;">
                <h1 class="text-5xl md:text-7xl font-bold tracking-tight bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 text-transparent bg-clip-text">
                    Unleash the Magic of StrxAI
                </h1>
                <p class="mt-4 max-w-2xl text-lg md:text-xl text-gray-400">
                    Your creative partner for instant answers, code generation, and limitless imagination.
                </p>
            </div>
            <button id="startChatBtn" class="mt-10 px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold rounded-full shadow-lg hover:scale-105 hover:shadow-2xl transform transition-all duration-300 animate-fadeInUp" style="animation-delay: 0.6s;">
                Start Chatting
            </button>

            <!-- Feature Cards Section -->
            <div class="mt-16 grid grid-cols-1 sm:grid-cols-3 gap-6 max-w-4xl w-full">
                <div class="feature-card animate-fadeInUp" style="animation-delay: 0.9s;">
                    <h3 class="font-semibold text-lg text-white">Creative Content</h3>
                    <p class="text-gray-400 mt-2 text-sm">Generate poems, scripts, emails, and more with a touch of magic.</p>
                </div>
                <div class="feature-card animate-fadeInUp" style="animation-delay: 1.1s;">
                    <h3 class="font-semibold text-lg text-white">Code Generation</h3>
                    <p class="text-gray-400 mt-2 text-sm">Get help with code, debug issues, and learn new programming concepts.</p>
                </div>
                <div class="feature-card animate-fadeInUp" style="animation-delay: 1.3s;">
                    <h3 class="font-semibold text-lg text-white">Instant Answers</h3>
                    <p class="text-gray-400 mt-2 text-sm">Ask complex questions and get insightful, easy-to-understand answers.</p>
                </div>
            </div>
        </div>


        <!-- Chat Page -->
        <div id="chatPage" class="absolute inset-0 flex-col h-full w-full bg-gray-800 rounded-lg shadow-2xl opacity-0 hidden">
            <!-- Header -->
            <header class="flex items-center justify-between p-4 bg-gray-900 border-b border-gray-700 shadow-md flex-shrink-0">
                <div class="flex items-center">
                    <div class="relative">
                        <img class="w-10 h-10 rounded-full" src="https://placehold.co/100x100/7E22CE/FFFFFF?text=S" alt="Avatar">
                        <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-gray-900 rounded-full"></span>
                    </div>
                    <div class="ml-3">
                        <h2 class="font-semibold text-lg">StrxAI Assistant</h2>
                        <p class="text-sm text-green-400">Online</p>
                    </div>
                </div>
                <button class="text-gray-400 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                    </svg>
                </button>
            </header>

            <!-- Messages Area -->
            <div id="chat-messages" class="flex-1 p-6 overflow-y-auto space-y-2">
                <!-- Messages will be dynamically added here -->
            </div>

            <!-- Input Area -->
            <footer class="p-4 bg-gray-900 border-t border-gray-700 flex-shrink-0">
                <form id="message-form" class="flex items-center space-x-3">
                    <input type="text" id="message-input" placeholder="Ask StrxAI anything..." autocomplete="off" class="w-full bg-gray-700 text-white rounded-full py-3 px-5 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-shadow">
                    <button type="submit" id="send-button" class="bg-purple-600 hover:bg-purple-700 text-white rounded-full p-3 shadow-lg transform hover:scale-105 transition-all duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </form>
            </footer>
        </div>

    </div>

    <script>
        const startChatBtn = document.getElementById('startChatBtn');
        const landingPage = document.getElementById('landingPage');
        const chatPage = document.getElementById('chatPage');
        const messageForm = document.getElementById('message-form');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');

        const API_KEY = ""; // Leave this empty, Canvas will handle it.
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;

        let chatHistory = [];

        // --- Page Transition Logic ---
        startChatBtn.addEventListener('click', () => {
            landingPage.classList.add('exit');
            
            landingPage.addEventListener('transitionend', () => {
                landingPage.classList.add('hidden');
            }, { once: true });

            chatPage.classList.remove('opacity-0', 'hidden');
            chatPage.classList.add('enter');
            
            setTimeout(() => {
                const welcomeText = 'Hello! I am StrxAI, your personal AI assistant. How can I help you today?';
                addMessage(welcomeText, 'received');
                chatHistory.push({ role: "model", parts: [{ text: welcomeText }] });
            }, 800);
        });

        // --- Chat Logic ---
        messageForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const messageText = messageInput.value.trim();

            if (messageText) {
                addMessage(messageText, 'sent');
                chatHistory.push({ role: "user", parts: [{ text: messageText }] });
                messageInput.value = '';
                getGeminiResponse();
            }
        });

        function addMessage(text, type, isLoading = false) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `flex items-end gap-2 max-w-md lg:max-w-lg ${type === 'sent' ? 'ml-auto justify-end' : 'mr-auto justify-start'}`;
            messageWrapper.style.animation = 'messageIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';

            if (isLoading) {
                messageWrapper.id = 'typing-indicator';
                messageWrapper.innerHTML = `
                    <img src="https://placehold.co/100x100/7E22CE/FFFFFF?text=S" alt="Bot Avatar" class="w-8 h-8 rounded-full flex-shrink-0">
                    <div class="p-3 rounded-2xl bg-gray-700 rounded-bl-lg flex items-center space-x-1">
                        <span class="w-2 h-2 bg-gray-400 rounded-full animate-pulse" style="animation-delay: 0s;"></span>
                        <span class="w-2 h-2 bg-gray-400 rounded-full animate-pulse" style="animation-delay: 0.2s;"></span>
                        <span class="w-2 h-2 bg-gray-400 rounded-full animate-pulse" style="animation-delay: 0.4s;"></span>
                    </div>
                `;
            } else {
                const messageBubble = document.createElement('div');
                messageBubble.textContent = text;
                messageBubble.className = `p-3 rounded-2xl shadow-md ${type === 'sent' 
                    ? 'bg-purple-600 text-white rounded-br-lg' 
                    : 'bg-gray-700 text-gray-200 rounded-bl-lg'}`;
                
                if (type === 'sent') {
                    messageWrapper.appendChild(messageBubble);
                } else {
                     const avatar = document.createElement('img');
                     avatar.src = 'https://placehold.co/100x100/7E22CE/FFFFFF?text=S';
                     avatar.alt = 'Bot Avatar';
                     avatar.className = 'w-8 h-8 rounded-full flex-shrink-0';
                     messageWrapper.appendChild(avatar);
                     messageWrapper.appendChild(messageBubble);
                }
            }

            chatMessages.appendChild(messageWrapper);

            // ✨ If it's a received message from the AI, add the "Suggest Replies" feature
            if (type === 'received' && !isLoading && text) {
                const suggestionsContainer = document.createElement('div');
                suggestionsContainer.className = 'flex justify-start pl-10 mt-1';
                const suggestButton = document.createElement('button');
                suggestButton.innerHTML = '✨ Suggest Replies';
                suggestButton.className = 'text-xs text-purple-400 hover:text-purple-300 transition-colors py-1 px-2 rounded-full bg-gray-800 hover:bg-gray-700 border border-gray-700';
                suggestButton.onclick = () => getSuggestedReplies(text, suggestionsContainer);
                suggestionsContainer.appendChild(suggestButton);
                chatMessages.appendChild(suggestionsContainer);
            }
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function apiCallWithBackoff(payload, isJson = false) {
            let attempt = 0;
            const maxAttempts = 5;
            let delay = 1000;

            while (attempt < maxAttempts) {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (isJson) {
                            return JSON.parse(result.candidates[0].content.parts[0].text);
                        }
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                } catch (error) {
                    console.error(`Attempt ${attempt + 1} failed:`, error);
                    attempt++;
                    if (attempt < maxAttempts) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Exponential backoff
                    } else {
                        return null; // Return null after all retries fail
                    }
                }
            }
        }


        async function getGeminiResponse() {
            addMessage('', 'received', true); // Show typing indicator
            sendButton.disabled = true;

            const payload = {
                contents: chatHistory,
                systemInstruction: {
                    parts: [{ text: "You are a friendly and helpful AI assistant named StrxAI. Keep your responses concise and conversational." }]
                }
            };

            const botReply = await apiCallWithBackoff(payload);
            
            document.getElementById('typing-indicator')?.remove();
            
            if (botReply) {
                addMessage(botReply, 'received');
                chatHistory.push({ role: "model", parts: [{ text: botReply }] });
            } else {
                addMessage("Sorry, I couldn't connect to the AI. Please try again.", 'received');
            }

            sendButton.disabled = false;
        }

        async function getSuggestedReplies(messageText, container) {
            container.innerHTML = `<span class="text-xs text-gray-400 px-2">Generating suggestions...</span>`;

            const suggestionHistory = [{
                role: "user",
                parts: [{ text: `The AI assistant (StrxAI) just said: "${messageText}". Suggest three distinct, short, and relevant replies that a user might send next. The replies should be natural and continue the conversation.` }]
            }];

            const payload = {
                contents: suggestionHistory,
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "suggestions": {
                                type: "ARRAY",
                                items: { type: "STRING" }
                            }
                        },
                        required: ["suggestions"]
                    }
                }
            };
            
            const result = await apiCallWithBackoff(payload, true);

            if (result && result.suggestions) {
                container.innerHTML = '';
                container.className = 'flex flex-wrap justify-start pl-10 mt-2 gap-2';
                result.suggestions.slice(0, 3).forEach(suggestion => {
                    const btn = document.createElement('button');
                    btn.textContent = suggestion;
                    btn.className = 'text-xs text-gray-200 bg-gray-700 hover:bg-purple-600 rounded-full px-3 py-1 transition-colors';
                    btn.onclick = () => {
                        messageInput.value = suggestion;
                        messageForm.dispatchEvent(new Event('submit', {'bubbles': true}));
                        container.remove();
                    };
                    container.appendChild(btn);
                });
            } else {
                container.innerHTML = `<span class="text-xs text-red-400 px-2">Failed to get suggestions.</span>`;
            }
        }

    </script>
</body>
</html>

